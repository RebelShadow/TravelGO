CREATE DATABASE IF NOT EXISTS TravelGo;

USE TravelGo;

CREATE TABLE restaurant (
	restaurant_id INT NOT NULL,
	restaurant_name VARCHAR(255) NOT NULL,
	restaurant_specific VARCHAR(255),
	restaurant_location VARCHAR(255) NOT NULL,
	restaurant_open_time TIME,
	restaurant_close_time TIME,
	PRIMARY KEY (restaurant_id)
);

CREATE TABLE review (
	review_id INT NOT NULL,
	user_id INT NOT NULL,
	title VARCHAR(255) NOT NULL,
	stars INT NOT NULL,
	body TEXT,
	created_at TIME,
	PRIMARY KEY (review_id)
);

CREATE TABLE restaurant_review (
	review_id INT NOT NULL,
	restaurant_id INT NOT NULL,
	PRIMARY KEY (review_id, restaurant_id),
	FOREIGN KEY (review_id) REFERENCES review (review_id),
	FOREIGN KEY (restaurant_id) REFERENCES restaurant (restaurant_id)
);

CREATE VIEW RestaurantReviewsView AS
SELECT r.restaurant_id, r.restaurant_name, r.restaurant_specific, r.restaurant_location, r.restaurant_open_time, r.restaurant_close_time,
       rv.review_id, rv.title, rv.stars, rv.body, rv.created_at
FROM restaurant r
JOIN restaurant_review rr ON r.restaurant_id = rr.restaurant_id
JOIN review rv ON rr.review_id = rv.review_id;

CREATE TABLE user (
	user_id INT NOT NULL,
	username VARCHAR(255) NOT NULL,
	password VARCHAR(255) NOT NULL,
	role VARCHAR(255) NOT NULL,
	created_at TIME NOT NULL,
	PRIMARY KEY (user_id)
);

CREATE TABLE wishlist (
	restaurant_id INT NOT NULL,
	user_id INT NOT NULL,
	PRIMARY KEY (restaurant_id, user_id),
	FOREIGN KEY (restaurant_id) REFERENCES restaurant (restaurant_id),
	FOREIGN KEY (user_id) REFERENCES user (user_id)
);
